<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Giovanni Bernini - Desenvolvedor Web">
  <meta name="author" content>
  <meta name="theme-color" content="#354b72">
  <link rel="icon" href="/img/favicon.ico">
  <title>Giovanni Bernini</title>

  <link rel="stylesheet" href="/css/style.css">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>
  <nav class="nav-bar">
  <div class="navitem"><a href="/"><img class="small" src="/img/gicon.png" alt="Logo do blog"></a></div>

  <div class="navitem main">
    
      
        <a class="item" href="/categorias/artigos">Artigos</a>
      
    
      
        <div class="navitem -featured">
          <a href="/">Home</a>
        </div>
      
    
      
        <a class="item" href="/categorias/projetos">Projetos</a>
      
    
  </div>

  <div class="navitem"><a class="navButton" onclick="openNav()">&#9776;</a></div>
</nav>

<div class="side-nav">
  <div class="navitem -submenu">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">Fechar Menu</a>
  </div>
  
    <div class="navitem -submenu">
      <a href="/">Home</a>
    </div>
  
    <div class="navitem -submenu">
      <a href="/categorias/artigos">Artigos</a>
    </div>
  
    <div class="navitem -submenu">
      <a href="/categorias/projetos">Projetos</a>
    </div>
  
    <div class="navitem -submenu">
      <a href="/about">Sobre mim</a>
    </div>
  
    <div class="navitem -submenu">
      <a href="/atom.xml">Feed</a>
    </div>
  
</div>
<div class="overlay"></div>



  
    <div class="header --post">
  <div class="post-header">
    <h1 class="title">Transformando uma aplicação React em um aplicativo nativo (Parte 2)</h1>
    <h3 class="subtitle">Criando a arquitetura do zero, explicando passo a passo.</h3>
  </div>
</div>

  

  
    <section class="main --post">
  

    <section class="content">
        <div class="blog-post">
  <!-- Content -->
  <p><em>Separei esse artigo em duas partes. Na segunda parte que você está lendo agora, entrarei mais afundo e criarei do zero a arquitetura, explicando passo a passo. Na primeira parte, eu mostro a estrutura de pensamento, que pode ajudar a entender se essa estratégia irá se adequar ao seu caso.</em></p>
<h2 id="Iniciando-o-projeto"><a href="#Iniciando-o-projeto" class="headerlink" title="Iniciando o projeto"></a>Iniciando o projeto</h2><p>Para essa primeira parte vamos precisar criar dois projetos, um para a aplicação web que será feita em React e outro para a aplicação nativa que será feita com React Native.</p>
<p>Não será abordado o setup inicial para rodar as aplicações React e React Native, mas você pode ler sobre isso <a href="https://react-native.rocketseat.dev/" target="_blank" rel="noopener">aqui</a>.</p>
<p>Para este artigo, eu criarei somente um repositório no Github, mas em um caso real onde terá outras pessoas codando, eu prefiro quebrar em dois repositórios para ficar mais organizado.</p>
<p><em>No fim deste artigo há a URL para o repositório, caso queira pular o passo a passo.</em></p>
<h2 id="Criacao-da-aplicacao-web-React"><a href="#Criacao-da-aplicacao-web-React" class="headerlink" title="Criação da aplicação web (React)"></a>Criação da aplicação web (React)</h2><p>Para facilitar a criação desse artigo e não misturar com outros assuntos e conceitos, irei usar o CRA (create-react-app) para iniciarmos um projeto React.</p>
<p>Vamos lá!</p>
<p><code>npx create-react-app web</code></p>
<p>Com o projeto criado, iremos colocar variáveis de ambiente no script de <em>start</em> e <em>build</em> para diferenciarmos nossa aplicação web e nativa quando precisarmos e adicionar um arquivo de estilos já pronto que vou deixar disponível <a href="https://raw.githubusercontent.com/giioohbernini/web-to-native/master/web/src/index.css" target="_blank" rel="noopener">aqui</a>. Basta copiar e salvar no arquivo index.css.</p>
<script src="https://gist.github.com/giioohbernini/de7175b56e3235dbef3d3d3e6410f1ba.js"></script>

<p>Agora precisamos criar um útil para recebermos essa informação, então irei criar uma pasta <em>utils</em>, e um arquivo chamado isApp.js com o seguinte código:</p>
<script src="https://gist.github.com/giioohbernini/b1dfa7c81fc1b02c838b87968689344d.js"></script>

<p>Com isso pronto, irei adicionar o react-router-dom para criarmos nossas rotas. Caso queira se aprofundar na biblioteca, você pode encontrar mais informações <a href="https://reactrouter.com/web/guides/quick-start" target="_blank" rel="noopener">aqui</a>.</p>
<p>yarn add react-router-dom ou npm install react-router-dom</p>
<p>Arquivo: App.js</p>
<script src="https://gist.github.com/giioohbernini/019e0493566af65f963d94921b537448.js"></script>

<p>Como mostrado nó código acima, separei em outros arquivos o Root, Home e About para deixar mais organizado.</p>
<p>> Arquivo: ./pages/Home/index.js</p>
<script src="https://gist.github.com/giioohbernini/66aa38856d3de7b281941f7946b4b160.js"></script>

<p>> Arquivo: ./pages/About/index.js</p>
<script src="https://gist.github.com/giioohbernini/07f26a9c06d6e159eb17a625e4041776.js"></script>

<p>> Arquivo: Root.js</p>
<script src="https://gist.github.com/giioohbernini/b8afe3f7617a3eec18212fea19ec554e.js"></script>

<p>No código acima, importei um módulo que eu criei chamado postMessage. Esse módulo tem a responsabilidade de se comunicar diretamente com o lado nativo via o método ReactNativeWebView.postMessage, que é inserido no window, assim usamos ele para sempre avisar o aplicativo nativo quando uma rota foi alterada e qual é a nova rota atual. Mais para baixo irei mostrar um caso real de onde podemos usar essa informação.</p>
<p>> Arquivo: utils/postMessage.js</p>
<script src="https://gist.github.com/giioohbernini/cf79a525b73f83d960a8c64ea87a680c.js"></script>

<p>Com essa comunicação podemos fazer várias outras coisas, como alternar entre uma página nativa e uma página web por exemplo.</p>
<h2 id="Criacao-da-aplicacao-nativa-React-Native"><a href="#Criacao-da-aplicacao-nativa-React-Native" class="headerlink" title="Criação da aplicação nativa (React Native)"></a>Criação da aplicação nativa (React Native)</h2><p>Agora com a parte web já preparada, podemos criar o nosso projeto React Native!</p>
<p>O comando abaixo vai iniciar o projeto, ele pode demorar um pouco dependendo da sua conexão.</p>
<p><code>npx react-native init app --template react-native-web-to-native-template</code></p>
<p>Reparem no parâmetro –template, onde eu passo o nome do boilerplate que deixei preparado com algumas coisas que iremos precisar.</p>
<p>Com o projeto criado, iremos abrir o arquvio webview.js que se encontrará no caminho src &gt; constants &gt; webview.js para atualizarmos a URL inicial do aplicativo o rootUrl. Como estamos trabalhando localmente, iremos colocar localhost com a porta default que o CRA criou para nossa aplicação web que foi a 3000, ficando dessa maneira abaixo:</p>
<p><code>export const rootUrl = &#39;http://localhost:3000/&#39;</code></p>
<p>Agora iremos rodar o projeto e ver como está!</p>
<p>yarn ios ou yarn android</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*AwVNfRN5CVMqATaR_-17Zw.png" alt></p>
<p>Com o nosso aplicativo rodando, agora podemos perceber no topo da tela que a barra superior do sistema não bate com a cor da aplicação. De acordo com o estilo já adicionado no começo do artigo, as cores são:</p>
<script src="https://gist.github.com/giioohbernini/79e117c561ea63adff7461bfeb47df4a.js"></script>

<p>Com isso, iremos usar a informação que mandamos via postMessage para conseguir manipular a cor do sistema conforme a página atual. Mas antes, iremos ver como a comunicação via postMessage funciona do lado do aplicativo e, para ficar claro, terei que passar por alguns arquivos.</p>
<p>> Trecho do arquivo: src/pages/Main/index.js (A página que renderiza o WebView)</p>
<script src="https://gist.github.com/giioohbernini/38d1c04048798b12c9af9b23a8c923c6.js"></script>

<p>No trecho acima, podemos perceber o uso do onMessage, o callback que o componente WebView irá chamar quando o método ReactNativeWebView.postMessage for executado. No nosso caso estamos passando o handleOnMessage como callback, então vamos ver o que ele está fazendo.</p>
<p>> Trecho do arquivo: src/pages/Main/hooks/useWebview.js (Um custom hook que estamos chamando no src/pages/Main/index.js)</p>
<script src="https://gist.github.com/giioohbernini/057eec349f0429956fa55be510e776fa.js"></script>

<p>No nosso <em>callback,</em> recebemos o evento e conseguimos extrair a informação que foi passada da nossa aplicação web acessando o event.nativeEvent.data. Como enviamos um <em>json </em>formatado como <em>string,</em> pois o postMessage só aceita <em>string</em>, agora podemos transformar nossa <em>string</em> para <em>json</em> de volta.</p>
<p>O messageEvents faz um papel bem importante de roteamento. Como o método que estamos usando para comunicação não nos fornece nenhuma estrutura (ele apenas transmite texto de um lado para o outro), foi preciso criar essa estrutura de roteamento para facilitar a nossa vida e deixar mais organizado. Na nomenclatura vou usar o termo event para facilitar o entendimento.</p>
<p>> Arquivo: src/utils/messageEvents/index.js</p>
<script src="https://gist.github.com/giioohbernini/eb5e9551db3e0d07278822dc31e9dbcc.js"></script>

<p>Como mostrado acima, usei <a href="https://ramdajs.com/" target="_blank" rel="noopener">RamdaJS</a> para criar essa estrutura (também poderia ser feita com switch case), que pega a propriedade eventName passada da aplicação web e endereça a função que vai receber e lidar com os dados. No caso atual estamos lidando somente com o routeChange que criamos, então vamos entender o que ele está fazendo.</p>
<p>> Arquivo: src/utils/messageEvents/routeChange.js</p>
<script src="https://gist.github.com/giioohbernini/d3b6b6340df0705d9dc76bec858f93db.js"></script>

<p>O routeChange verifica se o href existe e, caso exista, ele atualiza o estado que informa a url atual e também atualiza o status do canGoBack, que é quem controla se o app pode ou não fechar em uma ação de voltar.</p>
<p>Com tudo isso pronto e explicado, agora temos a informação da url atual no lado do <em>React Native</em> e podemos manipular a cor do sistema para que sempre fique igual ao topo da aplicação web.</p>
<p>> Arquivo: src/pages/Main/hooks/propsMapper.js</p>
<script src="https://gist.github.com/giioohbernini/bcd0546c3680cad1faa33133896d3f9f.js"></script>

<p>No custom hooks acima, pegamos a url atual que é passada para ele, extraimos a url limpa de <em>query strings</em> e passamos para a função getUrlToStatusBarColor, que está mapeando as urls e as respectivas cores e então retornamos isso diretamente para o componente Main que vai passar para o componente StatusBar.</p>
<p>> Trecho do arquivo: src/constants/webview.js</p>
<script src="https://gist.github.com/giioohbernini/0631b3cde4f8533035490ea5f16d4aa3.js"></script>

<p>Estamos adicionando no código acima as cores no mapa por url.</p>
<p>> Trecho do arquivo: pages/Main/index.js</p>
<script src="https://gist.github.com/giioohbernini/d413959c14ef76dfe29000446557960c.js"></script>

<p>No código acima, passamos a propriedade da cor para o StatusBar e para o SafeAreaView para de fato fazer as cores alterarem, vamos ver como ficou! Se você já estiver com o projeto rodando é só atualizar, se não tiver é só rodar o yarn ios ou yarn android ou olhar o gif abaixo:</p>
<p><img style="width: 350px" src="https://cdn-images-1.medium.com/max/2000/1*FDNzg5mc5c2ZZgEt78gs4A.gif"></p>
<p><a href="https://github.com/giioohbernini/web-to-native" target="_blank" rel="noopener">Repositório</a> com o código que desenvolvemos aqui nesse artigo.</p>
<h2 id="Conclusao"><a href="#Conclusao" class="headerlink" title="Conclusão"></a>Conclusão</h2><p>Encerro por aqui esse artigo, mas se quiser saber mais sobre essa implementação, leia a <a href="https://medium.com/@giovannibernini/como-transformar-uma-aplica%C3%A7%C3%A3o-web-react-em-um-aplicativo-nativo-da-noite-para-o-dia-6116b247f069" target="_blank" rel="noopener">primeira parte desse post</a>, onde mostro como chegamos nessa solução, o motivo e os ganhos que você pode ter caso esteja em um cenário parecido.</p>
<p>Espero que consigam adaptar no cenário de vocês e qualquer dúvida ou sugestão estarei respondendo os campos de comentários, obrigado!</p>
<h2 id="Links-uteis"><a href="#Links-uteis" class="headerlink" title="Links úteis"></a>Links úteis</h2><p><a href="https://github.com/react-native-community/react-native-webview/blob/master/docs/Reference.md#injectedjavascript" target="_blank" rel="noopener">Método postMessage que o React Native injeta no window</a><br><a href="https://github.com/react-native-community/react-native-webview/blob/master/docs/Reference.md#onmessage" target="_blank" rel="noopener">Parâmetro onMessage do componente WebView</a><br><a href="https://github.com/giioohbernini/web-to-native" target="_blank" rel="noopener">Repositório com o código do artigo</a><br><a href="https://github.com/react-native-community/react-native-webview/blob/master/docs/Reference.md#postmessagestr" target="_blank" rel="noopener">Método postMessage do componente WebView</a><br><a href="https://medium.com/@giovannibernini/como-transformar-uma-aplica%C3%A7%C3%A3o-web-react-em-um-aplicativo-nativo-da-noite-para-o-dia-6116b247f069" target="_blank" rel="noopener">Parte um desse artigo</a></p>

  <!-- https://www.facebook.com/sharer/sharer.php?u=https://giovannibernini.com.br -->
  <!-- Comments -->
  
    <div class="blog-post-comments">
        <h3>Comments:</h3>
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>

</div>

    </section>

    <footer class="footer">
    <p class="footer-content">Feito com Hexo</p>
</footer>

<script src="/js/index.js"></script>



<script src="/js/parallax.js"></script>

  </section>

  <!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'giovanni-bernini';
        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
